# OmniTrade AI

**OmniTrade AI** æ˜¯ä¸€æ¬¾å…ˆè¿›çš„å¤šæ¨¡æ€åŠ å¯†è´§å¸è‡ªä¸»äº¤æ˜“ç³»ç»Ÿã€‚å®ƒèåˆäº†å¾®è§‚ã€äº¤æ˜“ã€å®è§‚ç­‰å¤šå‘¨æœŸå¸‚åœºæ´å¯Ÿï¼Œåˆ©ç”¨å‰æ²¿çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¿›è¡Œè§†è§‰å›¾è¡¨åˆ†æä¸æ·±åº¦æ•°æ®æ¨ç†ï¼Œå®ç°å…¨è‡ªåŠ¨çš„è¶‹åŠ¿è·Ÿè¸ªä¸æ™ºèƒ½å†³ç­–ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

*   **å…¨ç»´å¤šå‘¨æœŸåˆ†æ**ï¼šåŒæ­¥ç›‘æ§å¾®è§‚ï¼ˆMicroï¼‰ã€äº¤æ˜“ï¼ˆTradeï¼‰ã€å®è§‚ï¼ˆMacroï¼‰ä¸‰ä¸ªç»´åº¦çš„å¸‚åœºèµ°åŠ¿ï¼Œæ•æ‰ä»æ—¥å†…æ³¢åŠ¨åˆ°é•¿æœŸè¶‹åŠ¿çš„æ¯ä¸€ä¸ªæœºä¼šã€‚
*   **å¤šæ¨¡æ€æ™ºèƒ½èåˆ**ï¼šåˆ›æ–°æ€§åœ°ç»“åˆæ•°å€¼æ•°æ®ï¼ˆOHLCV + EMAï¼‰ä¸è§†è§‰å›¾è¡¨ï¼ˆK çº¿å›¾æˆªå›¾ï¼‰ï¼Œæ¨¡æ‹Ÿäººç±»äº¤æ˜“å‘˜çš„â€œç›˜æ„Ÿâ€ä¸é€»è¾‘åˆ†æã€‚
*   **LLM é©±åŠ¨å†³ç­–å¼•æ“**ï¼š
    *   **è§†è§‰æ„ŸçŸ¥**ï¼šåˆ©ç”¨è§†è§‰å¤§æ¨¡å‹ï¼ˆå¦‚ Gemini Flashï¼‰ç²¾å‡†è¯†åˆ« K çº¿å½¢æ€ã€æ”¯æ’‘å‹åŠ›ä½åŠä»·æ ¼è¡Œä¸ºã€‚
    *   **é€»è¾‘æ¨ç†**ï¼šåˆ©ç”¨æ¨ç†å¤§æ¨¡å‹ï¼ˆå¦‚ GPT-4o/GPT-OSSï¼‰ç»“åˆå¨ç§‘å¤«ç†è®ºè¿›è¡Œæ·±åº¦å¸‚åœºç ”åˆ¤ã€‚
    *   **ç»¼åˆå†³ç­–**ï¼šå¤šç»´ä¿¡æ¯æ±‡æ€»ï¼Œè¾“å‡ºæ˜ç¡®çš„äº¤æ˜“æŒ‡ä»¤ï¼ˆå¼€å¤š/å¼€ç©º/å¹³ä»“/è§‚æœ›ï¼‰ã€‚
*   **åŠ¨æ€æ™ºèƒ½é£æ§**ï¼šå®æ—¶ç›‘æ§è´¦æˆ·æƒç›Šä¸ç»´æŒä¿è¯é‡‘ç‡ï¼ŒåŠ¨æ€è°ƒæ•´æ­¢æŸä½ç½®ä¸ä»“ä½å¤§å°ï¼Œç¡®ä¿èµ„é‡‘å®‰å…¨ã€‚
*   **ä¸Šä¸‹æ–‡è®°å¿†å‹ç¼©**ï¼šç‹¬ç‰¹çš„å†å²è®°å¿†æœºåˆ¶ï¼Œå°†è¿‡å¾€å†³ç­–å‹ç¼©ä¸ºç®€æ˜æ‘˜è¦ï¼Œä¸ºå½“å‰å†³ç­–æä¾›è¿è´¯çš„ä¸Šä¸‹æ–‡æ”¯æŒã€‚
*   **é«˜å¹¶å‘å¤šçº¿ç¨‹æ¶æ„**ï¼šé‡‡ç”¨ä¸»ä»æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šå¸ç§å¹¶è¡Œäº¤æ˜“ï¼Œæ¯ä¸ªäº¤æ˜“å¯¹ç‹¬ç«‹è¿è¡Œäº Worker çº¿ç¨‹ä¸­ï¼Œäº’ä¸å¹²æ‰°ã€‚

## ğŸ› ï¸ å®‰è£…ä¸è¿è¡Œ

### å‰ç½®è¦æ±‚

*   Node.js (v18+)
*   npm æˆ– yarn
*   OKX äº¤æ˜“æ‰€ API Key (éœ€æ”¯æŒ V5 API)
*   OpenAI / Google Gemini API Key

### å®‰è£…ä¾èµ–

```bash
npm install
```

### é…ç½®æŒ‡å—

1.  **åˆå§‹åŒ–ç¯å¢ƒå˜é‡**ï¼š
    å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶å¹¶é‡å‘½åä¸º `.env`ï¼š
    ```bash
    cp .env.example .env
    ```
    ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„ API Key ç­‰æ•æ„Ÿä¿¡æ¯ã€‚

2.  **åˆå§‹åŒ–é…ç½®æ–‡ä»¶**ï¼š
    å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶å¹¶é‡å‘½åä¸º `config.toml`ï¼š
    ```bash
    cp config.example.toml config.toml
    ```

3.  **è°ƒæ•´ç­–ç•¥å‚æ•°**ï¼š
    ç¼–è¾‘ `config.toml` æ–‡ä»¶ï¼Œæ ¹æ®éœ€æ±‚è°ƒæ•´ï¼š
    *   `[candle]`ï¼šè®¾å®šåˆ†æçš„æ—¶é—´å‘¨æœŸï¼ˆå¦‚ 1H, 4H, 1Dï¼‰ã€‚
    *   `[trade]`ï¼šé…ç½®äº¤æ˜“å¯¹ã€æ æ†å€æ•°åŠé£é™©æ§åˆ¶å‚æ•°ã€‚
    *   `[llm]`ï¼šé€‰æ‹©å¹¶é…ç½®ä½¿ç”¨çš„å¤§æ¨¡å‹å‚æ•°ã€‚

### å¯åŠ¨ç³»ç»Ÿ

**å¼€å‘æ¨¡å¼ï¼ˆæ¨èå¼€å‘è°ƒè¯•ä½¿ç”¨ï¼‰ï¼š**
```bash
npm start
```

**ç”Ÿäº§ç¯å¢ƒæ„å»ºä¸è¿è¡Œï¼š**
```bash
npm run build
node dist/index.js
```

## ğŸ§© ç³»ç»Ÿæ¶æ„

æœ¬ç³»ç»Ÿé‡‡ç”¨ç¨³å¥çš„ä¸»ä»ï¼ˆMaster-Workerï¼‰æ¶æ„ï¼Œä¸»è¿›ç¨‹è´Ÿè´£ç³»ç»Ÿåˆå§‹åŒ–ã€è‡ªæ£€ä¸ Worker è°ƒåº¦ï¼Œå­è¿›ç¨‹è´Ÿè´£å…·ä½“çš„ç­–ç•¥è®¡ç®—ä¸äº¤æ˜“æ‰§è¡Œã€‚

### æ ¸å¿ƒè¿è¡Œæµç¨‹

```mermaid
graph TD
    Start[å¯åŠ¨ç¨‹åº npm start] --> Main[src/index.ts ä¸»è¿›ç¨‹]
    
    subgraph Initialization [åˆå§‹åŒ–é˜¶æ®µ]
        Main --> SelfCheck[ç³»ç»Ÿè‡ªæ£€]
        SelfCheck --> CheckExchange[è¿æ¥ OKX]
        SelfCheck --> CheckLLM[è¿æ¥ LLM]
        CheckExchange -- å¤±è´¥ --> Exit[é€€å‡º]
        CheckLLM -- å¤±è´¥ --> Exit
    end

    Initialization -- æˆåŠŸ --> LoadConfig[åŠ è½½é…ç½® config.toml]
    LoadConfig --> LoopSymbols[è§£æäº¤æ˜“å¯¹åˆ—è¡¨]
    
    subgraph WorkerSpawning [å¤šçº¿ç¨‹è°ƒåº¦ä¸­å¿ƒ]
        LoopSymbols -->|Symbol A| SpawnWorkerA[å¯åŠ¨ Worker A]
        LoopSymbols -->|Symbol B| SpawnWorkerB[å¯åŠ¨ Worker B]
    end

    subgraph StrategyWorker [ç­–ç•¥ Worker çº¿ç¨‹]
        SpawnWorkerA --> StrategyLoop{ç­–ç•¥ä¸»å¾ªç¯}
        
        StrategyLoop --> Wait[ç­‰å¾… K çº¿æ”¶ç›˜]
        Wait -->|Trigger| FetchData[å¹¶è¡Œæ•°æ®è·å–]
        
        FetchData -->|Micro/Trade/Macro| GetCandles[è·å– OHLCV]
        
        subgraph Analysis [å¤šæ¨¡æ€å¹¶è¡Œåˆ†æå¼•æ“]
            GetCandles --> AnalyzeInterval[å‘¨æœŸæ•°æ®å¤„ç†]
            AnalyzeInterval --> CalcEMA[EMA æŒ‡æ ‡è®¡ç®—]
            AnalyzeInterval --> DrawChart[LWC å›¾è¡¨æ¸²æŸ“]
            
            DrawChart -->|å›¾åƒæµ| VisionLLM[è§†è§‰æ¨¡å‹åˆ†æ]
            CalcEMA -->|æ•°æ®æµ| DataLLM[æ•°æ®æ¨¡å‹åˆ†æ]
            
            GetCandles --> RiskAnalysis[è´¦æˆ·é£æ§æ‰«æ]
        end
        
        VisionLLM & DataLLM & RiskAnalysis --> Aggregate[å¤šç»´ä¿¡æ¯æ±‡æ€»]
        Aggregate --> DecisionLLM[å†³ç­–ä¸­æ¢ LLM]
        
        DecisionLLM --> ExecuteTrade[äº¤æ˜“æ‰§è¡Œæ¨¡å—]
        ExecuteTrade --> TradeAction[ä¸‹å•/æ’¤å•/é£æ§]
        
        DecisionLLM --> CompressHistory[è®°å¿†å‹ç¼©]
        CompressHistory --> SaveHistory[æ›´æ–°ä¸Šä¸‹æ–‡è®°å¿†]
        
        TradeAction --> StrategyLoop
        SaveHistory --> StrategyLoop
    end
```

### ç›®å½•ç»“æ„è¯´æ˜

*   `src/index.ts`: **ç³»ç»Ÿå…¥å£** - è´Ÿè´£ç¯å¢ƒæ£€æŸ¥ã€é…ç½®åŠ è½½ä¸ Worker å¯åŠ¨ã€‚
*   `src/core/`: **æ ¸å¿ƒé€»è¾‘**
    *   `run_strategy.ts`: ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
    *   `analyze_functions.ts`: LLM åˆ†ææ¥å£å®ç°ã€‚
    *   `trade_functions.ts`: äº¤æ˜“æŒ‡ä»¤æ‰§è¡Œä¸è®¢å•ç®¡ç†ã€‚
*   `src/connect/`: **å¤–éƒ¨è¿æ¥é€‚é…å™¨**
    *   `exchange.ts`: OKX V5 API å°è£…ã€‚
    *   `openai.ts`: LLM API (OpenAI/Gemini) æ ‡å‡†åŒ–å°è£…ã€‚
*   `src/util/`: **é€šç”¨å·¥å…·åº“** - åŒ…å«å›¾è¡¨ç»˜åˆ¶ã€æŒ‡æ ‡ç®—æ³•ã€æ—¥å¿—ç®¡ç†ç­‰ã€‚
*   `config.toml`: **å…¨å±€é…ç½®æ–‡ä»¶** - é›†ä¸­ç®¡ç†ç­–ç•¥ä¸ç³»ç»Ÿå‚æ•°ã€‚

## ğŸ“„ è®¸å¯è¯

ISC
